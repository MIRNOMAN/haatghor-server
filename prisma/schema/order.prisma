model Order {
  id              String      @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber     String      @unique
  userId          String      @db.ObjectId
  items           OrderItem[]
  totalAmount     Float
  discount        Float       @default(0)
  deliveryCharge  Float       @default(0)
  finalAmount     Float
  status          OrderStatus @default(PENDING)
  paymentMethod   PaymentMethod
  paymentStatus   PaymentStatus @default(PENDING)
  shippingAddress ShippingAddress
  trackingNumber  String?
  notes           String?
  
  // SSLCommerz payment fields
  sslCommerzTranId     String?
  sslCommerzValId      String?
  sslCommerzBankTranId String?
  sslCommerzCardType   String?
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("orders")
}

model OrderItem {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId     String   @db.ObjectId
  productId   String   @db.ObjectId
  quantity    Int
  price       Float    // Price at the time of order
  discount    Float    @default(0)
  selectedVariants Variant[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

type ShippingAddress {
  fullName    String
  phone       String
  email       String?
  address     String
  city        String
  state       String
  zipCode     String
  country     String
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  BKASH
  NAGAD
  SSLCOMMERZ
  CASH_ON_DELIVERY
  STRIPE
}
